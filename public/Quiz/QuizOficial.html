<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GamerGalaxy | Quiz</title>
    <link rel="stylesheet" href="Quiz_style.css">
    <link rel="icon" href="../assets/icon/iconControle.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script> <!--Utilizado uma nova API do ChartJS, que serve para manipuar o texto 
    presente na exibição dos valores do gráfico - 04/07-->
</head>

<body>
    <div class="fundo">
        <div class="header">
            <div class="container">
                <ul class="navbar">
                    <li><a href="../dashboard/Estrategia.html">+Gêneros</a></li>
                    <li><a>|</a></li>
                    <li><a href="../dashboard/cards.html">Início</a></li>
                    <li><a>|</a></li>
                    <li class="agora"><a href="QuizOficial.html">Quiz</a></li>

                </ul>
            </div>
        </div>
    </div>


    <div class="Pontuacao" id="Pontuacao">
        <div id="div_mensagem">
            <b>Pontos = 0/800</b> <!--Essa Div serve para Mostrar a Pontuação do usuário caso ele pontue ou não dentro do Quiz.
            De começo ela permanece com um texto já selecionado, mas que será atualizado quando o usuário responde a primeira questão
            do Quiz - Dia - 25/06  -->
            <!--Atualizando a pontuação total do usuário de 700 para 800 - 04/07-->
        </div>
    </div>

    <center>

        <div class="cartaoContorno">
            <div class="Questao" id="q1">
                <h2> Qual o jogo de Zumbi mais famoso da Capcom? </h2>
                <div class="opcao">
                    <input type="radio" id="q1A" name="q1" onclick="verificar()">
                    Resident Evil
                    <img src="../assets/Imagens Quiz/Resident_Evil.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q1B" name="q1" onclick="verificar()">
                    Silent Hill
                    <img src="../assets/Imagens Quiz/SilentHill.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q1C" name="q1" onclick="verificar()">
                    The Evil Within
                    <img src="../assets/Imagens Quiz/The Evil Within.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q1D" name="q1" onclick="verificar()">
                    Left 4 Dead
                    <img src="../assets/Imagens Quiz/Left4Dead.jpg">
                </div>
            </div>

            <div class="Questao" id="q2" style="display: none;">
                <h2>Qual o nome do Jogo onde o protagonista tem o nome de Kratos?</h2>
                <div class="opcao">
                    <input type="radio" id="q2A" name="q2" onclick="verificar()">
                    Shadow of the Colossus
                    <img src="../assets/Imagens Quiz/ShadowOfTheColossos.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q2B" name="q2" onclick="verificar()">
                    God of War
                    <img src="../assets/Imagens Quiz/GodOfWar.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q2C" name="q2" onclick="verificar()">
                    Uncharted
                    <img src="../assets/Imagens Quiz/Uncharted.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q2D" name="q2" onclick="verificar()">
                    Pokemon
                    <img src="../assets/Imagens Quiz/Pokemon.png">
                </div>
            </div>

            <div class="Questao" id="q3" style="display: none;">
                <h2> Qual o nome do protagonista do famoso jogo da Nintendo, Zelda?</h2>
                <div class="opcao">
                    <input type="radio" id="q3A" name="q3" onclick="verificar()">
                    Zelda
                    <img src="../assets/Imagens Quiz/Zelda.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q3B" name="q3" onclick="verificar()">
                    Kirby
                    <img src="../assets/Imagens Quiz/Kirby.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q3C" name="q3" onclick="verificar()">
                    Ash
                    <img src="../assets/Imagens Quiz/Ash.jpg">
                </div>
                <div class="opcao">
                    <input type="radio" id="q3D" name="q3" onclick="verificar()">
                    Link
                    <img src="../assets/Imagens Quiz/Link.png">
                </div>
            </div>

            <div class="Questao" id="q4" style="display: none;">
                <h2> Qual o jogo mais vendido da História?</h2>
                <div class="opcao">
                    <input type="radio" id="q4A" name="q4" onclick="verificar()">
                    Super Mario 64
                    <img src="../assets/Imagens Quiz/SuperMario64.jpg">
                </div>
                <div class="opcao">
                    <input type="radio" id="q4B" name="q4" onclick="verificar()">
                    Tetris
                    <img src="../assets/Imagens Quiz/Tetris.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q4C" name="q4" onclick="verificar()">
                    Minecraft
                    <img src="../assets/Imagens Quiz/Minecraft.jpeg">
                </div>
                <div class="opcao">
                    <input type="radio" id="q4D" name="q4" onclick="verificar()">
                    Grand Theft Auto V
                    <img src="../assets/Imagens Quiz/GTA_V.jpg">
                </div>
            </div>

            <div class="Questao" id="q5" style="display: none;">
                <h2> Quem é considerado o grande inimigo do Sonic?</h2>
                <div class="opcao">
                    <input type="radio" id="q5A" name="q5" onclick="verificar()">
                    Shadow
                    <img src="../assets/Imagens Quiz/Shadow.webp">
                </div>
                <div class="opcao">
                    <input type="radio" id="q5B" name="q5" onclick="verificar()">
                    Knuckles
                    <img src="../assets/Imagens Quiz/Knuckles.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q5C" name="q5" onclick="verificar()">
                    Tails
                    <img src="../assets/Imagens Quiz/Tails.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q5D" name="q5" onclick="verificar()">
                    Dr. Robotnik
                    <img src="../assets/Imagens Quiz/Dr.Robotnik.png">
                </div>
            </div>

            <div class="Questao" id="q6" style="display: none;">
                <h2> Quem Ganhou o Game of The Year de 2020?</h2>
                <div class="opcao">
                    <input type="radio" id="q6A" name="q6" onclick="verificar()">
                    Red Dead Redemption 2
                    <img src="../assets/Imagens Quiz/RedDeadRedemption2.jpeg">
                </div>
                <div class="opcao">
                    <input type="radio" id="q6B" name="q6" onclick="verificar()">
                    The Last of Us Part II
                    <img src="../assets/Imagens Quiz/TheLestOfUs.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q6C" name="q6" onclick="verificar()">
                    Sekiro
                    <img src="../assets/Imagens Quiz/Sekiro.jpg">
                </div>
                <div class="opcao">
                    <input type="radio" id="q6D" name="q6" onclick="verificar()">
                    The Witcher 3
                    <img src="../assets/Imagens Quiz/TheWitcher3.jpeg">
                </div>
            </div>

            <div class="Questao" id="q7" style="display: none;">
                <h2> Quem é o diretor da franquia Metal Gear Solid V: The Phantom Pain?</h2>
                <div class="opcao">
                    <input type="radio" id="q7A" name="q7" onclick="verificar()">
                    HIDEO KOJIMA
                    <img src="../assets/Imagens Quiz/Hideo Kojima.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q7B" name="q7" onclick="verificar()">
                    SHIGERU MIYAMOTO
                    <img src="../assets/Imagens Quiz/Shigeru Miyamoto.jpg">
                </div>
                <div class="opcao">
                    <input type="radio" id="q7C" name="q7" onclick="verificar()">
                    GABE NEWELL
                    <img src="../assets/Imagens Quiz/Gabe Newell.jpg">
                </div>
                <div class="opcao">
                    <input type="radio" id="q7D" name="q7" onclick="verificar()">
                    SAM E DAN HOUSE
                    <img src="../assets/Imagens Quiz/Sam e Dan.jpg">
                </div>
            </div>

            <!--Adicionando uma nova questão pra o Quiz - 04/07-->

            <div class="Questao" id="q8" style="display: none;">
                <h2> Em que ano foi lançado o primeiro Console?</h2>
                <div class="opcao">
                    <input type="radio" id="q8A" name="q8" onclick="verificar()">
                    No Ano de 1988
                    <img src="../assets/Imagens Quiz/Console1.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q8B" name="q8" onclick="verificar()">
                    No Ano de 1972
                    <img src="../assets/Imagens Quiz/Console2.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q8C" name="q8" onclick="verificar()">
                    No Ano de 1969
                    <img src="../assets/Imagens Quiz/Console3.png">
                </div>
                <div class="opcao">
                    <input type="radio" id="q8D" name="q8" onclick="verificar()">
                    No Ano de 1981
                    <img src="../assets/Imagens Quiz/Console4.png">
                </div>
            </div>
            <div class="Resultado" id="Resultado" style="display: none;">
                <h2>Aqui esta o Gráfico para mostrar quantas questões você Acertou:</h2>
                <div class="mensagem" style="color: tomato;" id="div_mensagem"></div>
                <div id="GfQuiz" style="width: 370px; height: 200px; display: none;">
                    <canvas id="myChart"></canvas>
                </div>
                <br>
            </div>
            <!--Adicionando um segundo gráfico na tela de resultados do Quiz - 05/07 --> 
            <div class="Resultado2" id="Resultado2" style="display: none;">
                <h2>percentual de Quantas questões você acertou:</h2>
                <div class="mensagem" style="color: tomato;" id="div_mensagem"></div>
                <div id="GfQuiz2" style="width: 370px; height: 200px; display: none;">
                    <canvas id="myChart2"></canvas>
                </div>
                <br>
                <button style="display: block;" class="btn-nav-white" id="Botao" onclick="Salvar()">Salvar Pontuação</button>
            </div>

        </div>
    </center>


</body>

</html>

<script>
    var contq = 1;
    var Questoes_Certas = 0;
    var Questoes_Erradas = 8;

    var Pontuacao_Max = 800; //Atualizando o MAX de pontos que o usuário pode fazer de 700 para 800 - 04/07
    var Sua_Pontuacao = 0;

    var porcentagem_Acertos = 0; // Adicionando uma nova variavel para calcular a porcentagem de Acertos e Erros do Usuário - 04/07
    var porcentagem_Erros = 0; // Adicionando uma nova variavel para calcular a porcentagem de Acertos e Erros do Usuário - 04/07

    function Porcentagem() { //Função que Caucula a porcentagem de acertos e Erros do usuário - 04/07
            porcentagem_Acertos = Questoes_Certas * 100 / (Questoes_Certas + Questoes_Erradas).toFixed(0);
            porcentagem_Erros = Questoes_Erradas * 100 / (Questoes_Certas + Questoes_Erradas).toFixed(0);

            
        }


    function verificar() {

        if (contq == 1) {

            if (q1A.checked) {
                Questoes_Certas++;
                Sua_Pontuacao += 100;
                Questoes_Erradas--;
            }
            contq++;
            q1.style.display = "none";
            q2.style.display = "block";

        }
        else if (contq == 2) {

            if (q2B.checked) {
                Questoes_Certas++;
                Sua_Pontuacao += 100;
                Questoes_Erradas--;
            }
            contq++;
            q2.style.display = "none";
            q3.style.display = "block";
        }
        else if (contq == 3) {

            if (q3D.checked) {
                Questoes_Certas++;
                Sua_Pontuacao += 100;
                Questoes_Erradas--;
            }
            contq++;
            q3.style.display = "none";
            q4.style.display = "block";
        }
        else if (contq == 4) {

            if (q4B.checked) {
                Questoes_Certas++;
                Sua_Pontuacao += 100;
                Questoes_Erradas--;
            }
            contq++;
            q4.style.display = "none";
            q5.style.display = "block";
        }
        else if (contq == 5) {

            if (q5D.checked) {
                Questoes_Certas++;
                Sua_Pontuacao += 100;
                Questoes_Erradas--;
            }
            contq++;
            q5.style.display = "none";
            q6.style.display = "block";
        }
        else if (contq == 6) {

            if (q6B.checked) {
                Questoes_Certas++;
                Sua_Pontuacao += 100;
                Questoes_Erradas--;
            }
            contq++
            q6.style.display = "none";
            q7.style.display = "block";
        }
        else if (contq == 7) {

            if (q7A.checked) {
                Questoes_Certas++;
                Sua_Pontuacao += 100;
                Questoes_Erradas--;
            }
            contq++
            q7.style.display = "none";
            q8.style.display = "block";
        }
        else if (contq == 8) {

            if (q8B.checked) {
                Questoes_Certas++;
                Sua_Pontuacao += 100;  
                Questoes_Erradas--;
            }
            contq++;
            q8.style.display = "none";
            GfQuiz.style.display = "block";
            Resultado.style.display = "block";
            GfQuiz2.style.display = "block";  //Função que faz com que o grafico apareça - 04/07
            Resultado2.style.display = "block"; //Função que faz com que a Div em que o gráfico esta, apareça - 04/07

            Porcentagem();

            atualizarGrafico1();  // Separei em duas funções diferentes para que não desse problema na hora de executar essas funções - 04/07
            atualizarGrafico2();
        }



        for (cont = Sua_Pontuacao; cont <= Pontuacao_Max; cont++) {
            document.getElementById('div_mensagem').innerHTML = `<b>Pontos = ${Sua_Pontuacao}/${Pontuacao_Max}</b>`
            /*É nesse FOR, que o texto presente na Div PONTUACAO será atualizado, mas isso só acontece quando o usuario responde
             a primeira questão do Quiz - Dia - 25/06 */
        }

    }

/* ----------- Gráfico de Acertos e Erros -------------- */

    const labels = [
        'Acertos',
        'Erros',
    ];

    const data = {
        labels: labels,
        datasets: [{
            label: 'Pontuação',
            backgroundColor: ['green', 'red'],
            data: [Questoes_Certas, Questoes_Erradas],
        }
        ]
    };


    const config = {
        type: 'pie',
        data: data,
        options: {}
    };

/* ----------- Gráfico de Porcentagem -------------- */

    const labels2 = [
        'Acertos',
        'Erros',
    ];

    const data2 = {
        labels: labels2,
        datasets: [{
            label: 'Pontuação',
            backgroundColor: ['green', 'red'],
            data: [parseFloat(porcentagem_Acertos), parseFloat(porcentagem_Erros)],
        }
        ]
    };

    const config2 = {
            type: 'doughnut', //Aqui é o tipo de gráfico usado - 05/07.
            data: data2, //Aqui temos os dados que serão utlizados, que no caso, são os dados da variavel "data2" - 05/07.
            options: {
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) { // Essa função aqui, serve para personalizar o Texto da ToolTip, que é justamente o texto que aparece
                                // quando se coloca o cursor do Mouse em algum dos campos de valores do Gráfico - 05/07.

                                //Este parâmetro é um objeto fornecido pelo Chart.js que contém informações sobre o item atual da tooltip - 05/07.
                                //Ele é passado automaticamente quando o usuário interage com o gráfico. - 05/07.

                                var dataset = tooltipItem.dataset.data; // Aqui é onde ele irá obter os valores das variaveis
                                // "[porcentagem_Acertos, porcentagem_Erros]" - 05/07.

                                var total = dataset.reduce((prev, curr) => prev + curr, 0); // Aqui ele calcula a soma total de todos os valores no conjunto de dados, onde
                                // ele soma todos os valores do array dataset para obter o total geral - 05/07.

                                var currentValue = dataset[tooltipItem.dataIndex]; // É o índice do dado específico no array data
                                // que corresponde ao segmento do gráfico sobre o qual o usuário passa o mouse - 05/07.

                                var porcentagem = ((currentValue / total) * 100).toFixed(1); // Primeiro ele realiza o calculo da porcentagem
                                // e depois formata o resultado com uma casa decimal, graças ao ToFixed(1) - 05/07.

                                return porcentagem + "%"; // Retorna a porcentagem calculada como uma string formatada para exibição na tooltip - 05/07.
                            }
                        }
                    }
                }
            }
        };

    // Aqui é inicializado a variável 'myChart' como null. Esta variável armazenará uma instância do gráfico 'Chart'. - 04/07
    let myChart = null;
    let myChart2 = null; 



    function atualizarGrafico1() {

        if (myChart) {
            myChart.destroy();
        }
        data.datasets[0].data = [Questoes_Certas, Questoes_Erradas];
        myChart = new Chart(
            document.getElementById('myChart'),
            config
        );

    }


    function atualizarGrafico2(){
        // Nesse IF, será verificado se já existe valores no gráfico myChart2, se sim ele é apagado, para depois ser atualizado. - 04/07
        if (myChart2) {
            myChart2.destroy();  //Está Função serve para destruir os antigos valores que o gráfico Chart.JS tem. - 04/07
        }
        data2.datasets[0].data = [parseFloat(porcentagem_Acertos), parseFloat(porcentagem_Erros)];
        myChart2 = new Chart(
            document.getElementById('myChart2'),
            config2

            //E Logo em seguida, é executada esta função, que cria um novo gráfico com os valores reatribuidos, e esses valores são
            // justamente o que estiver dentro "[]" após o "data2.datasets[0].data = ... " - 04/07

            //Após esses valores serem definidos, ele vê onde eles serão alocados, e é ai que tem que definir qual ID de gráfico Canvas 
            // vai ser utilizado, que no caso é o gráfico de ID myChart2 (Gráfico de Porcentagem). - 04/07
        );
    }

    window.onload = function () {
        Porcentagem();
        atualizarGrafico1();
        atualizarGrafico2();

    };




    function Salvar() {

        var certas = Questoes_Certas;
        var erradas = Questoes_Erradas;
        var pontos = Sua_Pontuacao; //Adionando uma Variável para guardar os pontos do Usuário - 01/07
        var idUsuario = sessionStorage.ID_USUARIO;


        fetch(`/usuarios/Salvar/${idUsuario}`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                respostasCorretasServer: certas,
                respostasIncorretasServer: erradas,
                PontuacaoServer: pontos,  //Agora a Pontuação também vai para o Banco de Dados - 01/07
                idUsuarioServer: sessionStorage.ID_USUARIO
            }),
        })

        Botao.style.display = "none";
    }

</script>